# End-to-end learned video compression，channel-wise

## 瞎想

**什么是硬件感知的量化呢 Hardware-Aware quantization**

1. **idea：由于video codec模型网络比较大，所以不同的layer或channel对于量化的敏感度也不同，计算量化误差对于task loss的影响，来获得不同layer的bit-width进行量化**
2. **idea3：引入量化误差作为辅助损失帮助训练，这个不确定，再看看**
3. **找一个最优化方法，来对layer按照distribution的差异进行分组，每个组对应一个scale和zero_point**



基于海森矩阵的量化敏感度分析



**参考GN等，对activation进行分组的量化？每个组有单独的scale和zeor_point；group-wise的分组方法采用自适应的学习方法？可以参考混合精度的搜索方式；同时为了避免group数过大，导致和channel数一致，进而产生高的计算开销，可以添加一个约束项，具体参考GroupQ这里的目标函数。（约束模型大小/约束计算复杂度）**



正则项：计算flops和量化误差保持一个平衡关系 lmbda

**辅助损失？**

**辅助监督的混合精度量化？**



平衡计算负载和量化性能

prune和clip



## TASK

### 关于模型中不同模块对于量化的敏感度差异

- [x] 只量化mv encoder/decoder
- [x] 只量化 mv estimator
- [x] 只量化 contextual encoder/decoder

### 每个阶段收敛后进行quant

- [x] quant时其他模块保持全精度

  > 其他模块保持全精度的同时，并未处于训练状态，参数不会更新

- [x] quant时前面已训练的模块保持量化精度

### 量化敏感度

- [ ] 确定模型关于量化敏感度的计算方式（根据每个channel的提取细节、结构和纹理不同，展示量化敏感度和每个channel提取的context细节的关联。）
- [ ] 统计不同layer/channel对于量化的敏感度
- [ ] 根据量化敏感度确定per-layer/channel/patch的bit——混合精度

### 如何确定flops等性能？导出ONXX模型？



## IDEA

### 辅助模块-类蒸馏思想

- 由于替换relu后丢失了非线性性，在adapter后跟一个GDN，弥补非线性；
- 防止误差累计：在每一个模块后，引入全精度的特征进行矫正？
- 构建一个提取复杂纹理/结构/等信息的模块，对低精度模块进行辅助指导？

### 结合Memory augmented的多帧信息融合

### 编码+prompt 超低bit rate下的视频编码

