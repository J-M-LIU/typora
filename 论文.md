# End-to-end learned video compression，channel-wise

## 瞎想

**什么是硬件感知的量化呢 Hardware-Aware quantization**

1. **idea：由于video codec模型网络比较大，所以不同的layer或channel对于量化的敏感度也不同，计算量化误差对于task loss的影响，来获得不同layer的bit-width进行量化**
2. **idea3：引入量化误差作为辅助损失帮助训练，这个不确定，再看看**
3. **找一个最优化方法，来对layer按照distribution的差异进行分组，每个组对应一个scale和zero_point**



基于海森矩阵的量化敏感度分析



**参考GN等，对activation进行分组的量化？每个组有单独的scale和zeor_point；group-wise的分组方法采用自适应的学习方法？可以参考混合精度的搜索方式；同时为了避免group数过大，导致和channel数一致，进而产生高的计算开销，可以添加一个约束项，具体参考GroupQ这里的目标函数。（约束模型大小/约束计算复杂度）**



正则项：计算flops和量化误差保持一个平衡关系 lmbda

**辅助损失？**

**辅助监督的混合精度量化？**



平衡计算负载和量化性能

prune和clip



## TASK

### 关于模型中不同模块对于量化的敏感度差异

- [x] 只量化mv encoder/decoder
- [x] 只量化 mv estimator
- [x] 只量化 contextual encoder/decoder

### 每个阶段收敛后进行quant

- [x] quant时其他模块保持全精度

  > 其他模块保持全精度的同时，并未处于训练状态，参数不会更新

- [x] quant时前面已训练的模块保持量化精度

### 量化敏感度

- [ ] 确定模型关于量化敏感度的计算方式（根据每个channel的提取细节、结构和纹理不同，展示量化敏感度和每个channel提取的context细节的关联。）
- [ ] 统计不同layer/channel对于量化的敏感度
- [ ] 根据量化敏感度确定per-layer/channel/patch的bit——混合精度

### 如何确定flops等性能？导出ONXX模型？



## IDEA

### 辅助模块-类蒸馏思想——直接改成时间/空间context信息蒸馏好了

- 由于替换relu后丢失了非线性性，在adapter后跟一个GDN，弥补非线性；
- 防止误差累计：在每一个模块后，引入全精度的特征进行矫正？
- 构建一个提取复杂纹理/结构/等信息的模块，对低精度模块进行辅助指导？
- 误差累计要如何解决？多阶段训练过程

### 混合bit

- 构建一个提取复杂纹理/结构/等信息的模块，然后混合精度？

### channel split + context 空间+时间+层次蒸馏

channel split 多用于消除异常值+提取高频纹理信息

### 结合Memory augmented的多帧信息融合

### 编码+prompt 超低bit rate下的视频编码









mv/context通过全精度的编码器+解码器后，（其中需包含GDN补足非线性和通道交互），尤其是再额外添加一个复杂结构/纹理等信息的提取模块，与mv/context concat等操作后，解码得到的全精度mv/context与低精度的这两个信息比较分布相似度，loss按照分布相似度或者其他计算方式。相当于以低精度网络的

**引入自蒸馏的思想来解决低精度和全精度之间分布差异的问题**

**纹理**

**结构**

**动作信息**

而且全精度辅助模块，应该在编码mv/context信息后就做一次分布指导，因为需要分别指导低精度encoder和decoder学习信息的能力。

**CVPR2020：Structure-Preserving Super Resolution with Gradient Guidance**基于梯度信息指导的图像超分











行文思路：

1. 分阶段量化后，探究各阶段量化后对网络性能的影响程度。单量化ME/量化ME+MV/量化ME、MV、Context编解码器，发现单独量化ME对于性能的影响很小， 发现MV encoder/decoder 和 context encoder/decoder对于性能的影响起到关键作用。因此针对这两个编解码器的调优进行了优化。——然后给图：context和encoder分布差异大；GDN的影响分析。



2. 纹理/结构提取块
3. 时间信息提取块
4. 运动信息辅助提取块

